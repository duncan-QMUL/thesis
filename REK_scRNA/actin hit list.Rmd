---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 


```{r}
library("readxl")
library('dplyr')
library('tidyverse')
library('Seurat')
library('xlsx')
```
```{r}
setwd("~/OneDrive - Queen Mary, University of London/QMUL/Lab/Coding/data/R/Seurat/SandLKerato")
kerato <- readRDS(file = "pseudoSLkera.rds")
cluster_markers <- kerato.markers %>% group_by(cluster) %>% filter(!between(avg_log2FC, -0.6, 0.6) & p_val_adj < 0.05)
```

```{r}
setwd("~/OneDrive - Queen Mary, University of London/QMUL/Lab/Data/Misc/Actin Binding RattusNor all GO terms")
# character vector of genes from HVGs, kerato must be defined for this to work. 


HVG_genelist <- VariableFeatures(kerato)


#import excel file of actin binding genes.
actindf <- read_excel("~/OneDrive - Queen Mary, University of London/QMUL/Lab/Data/Misc/Actin Binding RattusNor all GO terms/all GO terms.xlsx")

#drop columns
actindf <- actindf[ -c(1:4,6:7)]
actindf

#pull into character vector
actin_list <- dplyr::pull(actindf, Abitram)

```

```{r}
#intersect the actin markers with HVG list. 
hits <- intersect(HVG_genelist, actin_list)
write.xlsx(hits,"actinmarkerhits.xlsx")
```

```{r}
#intersect all cluster markers with +/- 0.6 log2FC and p <0.05 with actin hits
cluster_markers_genes <- cluster_markers[ -c(1:6)]
cluster_markers_genes

cluster_markers_genes_list <- cluster_markers_genes %>% pull(gene)
cluster_markers_genes_list

hits2 <- intersect(cluster_markers_genes_list, actin_list)
hits2

any_hits <- intersect(hits, hits2)


```

```{r}
setwd("~/OneDrive - Queen Mary, University of London/QMUL/Lab/Data/Misc/Actin Binding RattusNor all GO terms")
#Need to link this back to the p values.
#pull rows from cluster_markers using filter, with p-values
titles <- c("p_value", "av_log2FC", "pct.1","pct.2", "p_val_adj","cluster","gene")
hits_info <- data.frame(row.names = titles)

for (name in any_hits){
  
  
  info <- cluster_markers %>% filter(str_detect(gene, name))
  hits_info <- rbind(hits_info, info)
  
}

hits_info[-c(3:4)]
write.xlsx(hits_info,"hits_data.xlsx")
```

```{r}
#This chunk will be designed to pull information about any list of genes - manually inputted, and subject them to the same serial intersection process as described abobe
setwd("~/OneDrive - Queen Mary, University of London/QMUL/Lab/Data/Misc/Actin Binding RattusNor all GO terms")
# character vector of genes from HVGs, kerato must be defined for this to work. 
HVG_genelist <- VariableFeatures(kerato)

interest_list <- c('Ctsb','Ctsl','Ctsd','Ctss','Ctsh','Ctsc','Ctsk','Ctse','Ctsg','Ctsz','Ctsj','Ctsf','Ctsr','Ctsm','Cts7','Ctsa','Ctsq') #character vector with gene names

overlap <- intersect(HVG_genelist, interest_list)

titles <- c("p_value", "av_log2FC", "pct.1","pct.2", "p_val_adj","cluster","gene")
hits_info <- data.frame(row.names = titles)

for (name in overlap){
  
  
  info <- cluster_markers %>% filter(str_detect(gene, name))
  hits_info <- rbind(hits_info, info)
  
}

hits_info[-c(3:4)]
write.xlsx(hits_info,"xxxxxhits_data.xlsx") #rename for each iteration if you want to keep the file. 

```

